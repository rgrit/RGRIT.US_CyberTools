# Flipper Zero BadUSB Detection Sigma Rules

This repository contains a set of Sigma rules and sample logs designed to detect suspicious USB activity associated with Flipper Zero BadUSB devices. The rules were developed through a purple team approach to identify adversarial behaviors that leverage unusual USB identifiers and enumeration patterns.

## Repository Contents

- **Sigma Rules:**
  - `lnx_syslog_flipper_badusb_identifiers.yml`  
    Detects USB device insertion events containing one or more indicators associated with Flipper Zero BadUSB devices:
    - Unusual vendor/product ID: `"1234:ABCD"`
    - Manufacturer: `"Brain Actuated Technologies"`
    - Registered device name: `"Generic USB Keyboard"`
  - `lnx_syslog_flipper_badusb_repeated.yml`  
    A correlation rule that aggregates events from the above detection rule. It triggers if three or more suspicious enumeration events occur within a 5‑minute timespan on the same host.
  - `lnx_syslog_flipper_badusb_inconsistent_branding.yml`  
    Detects instances where the device is reported with an unusual manufacturer yet is registered as a generic USB keyboard, indicating a potential masquerading behavior.
  
- **Sample Logs:**
  - `sample_logs.txt`  
    Contains example syslog entries captured from a Linux system showing multiple USB enumeration events with the suspicious identifier `"1234:ABCD"`. These logs serve as test data for validating the Sigma rules.

## Log Generation

The sample logs were generated by the `linux_recon_and_cleanup.txt` Ducky script from the Ducky Script Library. This script performs comprehensive system reconnaissance and cleanup operations on Linux systems. During its execution, it generates standard kernel and session log entries for USB device insertions. The logs capture the enumeration of devices that exhibit unusual characteristics—such as the vendor/product ID `"1234:ABCD"` and the generic device naming—which are leveraged by the Sigma rules in this repository.

## Purple Team Thinking

These Sigma rules represent a defensive, purple team approach by:
- Identifying adversary tactics where a malicious device, such as a Flipper Zero BadUSB, masquerades as a generic peripheral.
- Correlating multiple suspicious events (rapid USB enumeration and inconsistent device branding) to increase detection fidelity.
- Demonstrating the value of proactive detection and continuous monitoring of USB activity as part of a broader security strategy.

## How to Use

1. **Test the Sigma Rules:**  
   Use a Sigma-compatible tool (e.g., [pySigma](https://github.com/Neo23x0/pySigma)) to convert these rules into queries for your SIEM or log analysis platform.

2. **Validate with Sample Logs:**  
   Import `sample_logs.txt` into your SIEM or run local tests to verify that the rules correctly identify the suspicious USB events. Adjust field mappings or timeframes as necessary to fit your environment.

3. **Integrate into Monitoring:**  
   Once validated, deploy these rules in your production SIEM environment to continuously monitor for potential BadUSB activity. The rules will help in detecting both isolated and repeated anomalous USB events.

## Disclaimer

These rules are provided for educational and authorized security testing purposes only. Use them solely in environments where you have explicit permission to perform such monitoring. The authors assume no responsibility for misuse of these tools.

---

By leveraging both custom Ducky scripts for data collection and advanced Sigma correlation techniques, this repository exemplifies a proactive purple team strategy for detecting hardware-based attack vectors such as those enabled by Flipper Zero BadUSB devices.